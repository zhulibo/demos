<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no">
    <title>Document</title>
    <!-- 重置样式 -->
    <link rel="stylesheet" href="css/reset.css">
    <!-- 主样式 -->
    <link rel="stylesheet" href="css/main.css">
    <!-- jq -->
    <script src="js/jquery-2.1.4.min.js"></script>
</head>

<body>
    <div id="paomadeng">
        <ul>
            <li>
                <div class="wrap1">
                    <div class="wrap2">1</div>
                </div>
            </li>
            <li>
                <div class="wrap1">
                    <div class="wrap2">2</div>
                </div>
            </li>
            <li>
                <div class="wrap1">
                    <div class="wrap2">3</div>
                </div>
            </li>
            <li>
                <div class="wrap1">
                    <div class="wrap2">4</div>
                </div>
            </li>
            <li>
                <div class="wrap1">
                    <div class="wrap2">5</div>
                </div>
            </li>
            <li>
                <div class="wrap1">
                    <div class="wrap2">6</div>
                </div>
            </li>
            <li>
                <div class="wrap1">
                    <div class="wrap2">7</div>
                </div>
            </li>
            <li>
                <div class="wrap1">
                    <div class="wrap2">8</div>
                </div>
            </li>
        </ul>
        <div class="btn_chou">
            <div class="wrap btn_chou_this"></div>
        </div>
        <script type="text/javascript">
            var lottery = {
                click: true, // 抽奖开关，避免抽奖过程中再次点击
                index: 0, // 转动到哪个位置
                count: 0, // 总共有多少个位置
                times: 0, // 转动次数
                cycle: 50, // 转动基本次数
                speed: 100, // 转动速度
                prize: -1, // 中奖位置
                timer: 0, // setTimeout的ID
                init: function(id) {
                    this.obj = $(id);
                    this.li = this.obj.find('li');
                    this.count = this.li.length;
                },
                roll: function() {
                    this.li.removeClass('on');
                    this.li.eq(this.index).addClass('on');
                    this.index += 1;
                    if (this.index > this.count) {
                        this.index = 0;
                    }
                }
            }

            function zhuan() {
                lottery.times += 1;
                lottery.roll();
                // 停止转动
                if (lottery.times > lottery.cycle && lottery.prize == lottery.index) {
                    clearTimeout(lottery.timer);
                    console.log(lottery.prize)
                    // 恢复参数默认值
                    lottery.prize = -1;
                    lottery.times = 0;
                    lottery.speed = 100;
                    lottery.click = true;
                    return false;
                }
                // 点击后抽奖开始加速
                if (lottery.times < lottery.cycle - 5) {
                    lottery.speed -= 10;
                }
                // 转动基本次数后开始减速
                else {
                    lottery.speed += 20;
                }
                // 限制最小速度
                if (lottery.speed < 40) {
                    lottery.speed = 40;
                };
                // 重复调 zhuan()
                lottery.timer = setTimeout(zhuan, lottery.speed);
            }

            $(document).ready(function() {
                // 初始化
                lottery.init('#paomadeng');
                // 点击抽奖
                $('.btn_chou_this').click(function() {
                    if (lottery.click) {
                        lottery.click = false;

                        zhuan();

                        // $.ajax({
                        //     url: "123.php",
                        //     data: {},
                        //     type: "get",
                        //     dataType: "json",
                        //     // timeout: 1000, // 时间限制
                        //     success: function(data) {
                        //         lottery.prize = data.prize; // 指针停的位置
                        //     },
                        //     error: function(error) {
                        //         alert('网络超时');
                        //         clearTimeout(lottery.timer);
                        //         // 恢复默认值
                        //         lottery.prize = -1;
                        //         lottery.times = 0;
                        //         lottery.speed = 100;
                        //         lottery.click = true;
                        //         $('#paomadeng li').removeClass('on');
                        //     }
                        // })

                        // 模拟ajax请求成功
                        var xxxxxx = parseInt(Math.random() * (lottery.count) + 1); // 1-8
                        lottery.prize = xxxxxx; // 指针停的位置
                    }
                })
            })
        </script>
    </div>
</body>

</html>
